name: Generate Paper PDFs
on: [push]

jobs:
  paper:
    runs-on: ubuntu-latest
    name: Paper Draft and Preprint
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # ✅ Generate Draft PDF
      - name: Build Draft PDF
        uses: ./.github/actions/openjournals-pdf
        with:
          journal: joss
          paper-path: paper/paper.md
          output-type: pdf

      # ✅ Upload the Draft PDF
      - name: Upload Draft PDF
        uses: actions/upload-artifact@v4
        with:
          name: draft-paper
          path: paper/paper.pdf

      # ✅ Generate Preprint (This creates `paper.preprint.tex`)
      - name: Build Preprint (Generates .tex)
        uses: ./.github/actions/openjournals-pdf
        with:
          journal: joss
          paper-path: paper/paper.md
          output-type: preprint

      # ✅ List contents of paper/ to verify the preprint `.tex` file exists
      - name: List contents of paper/
        run: ls -lah paper/

      # ✅ Install LaTeX Packages
      - name: Install LaTeX
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-latex-base texlive-fonts-recommended texlive-fonts-extra texlive-latex-extra

      # ✅ Compile Preprint PDF from LaTeX
      - name: Compile Preprint PDF
        run: |
          pdflatex -output-directory paper paper/paper.preprint.tex
          pdflatex -output-directory paper paper/paper.preprint.tex  # Run twice for proper formatting

      # ✅ List contents of paper/ to check if `paper.preprint.pdf` was created
      - name: List final contents of paper/
        run: ls -lah paper/

      # ✅ Upload the Preprint PDF
      - name: Upload Preprint PDF
        uses: actions/upload-artifact@v4
        with:
          name: preprint-paper
          path: paper/paper.preprint.pdf
